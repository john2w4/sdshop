# 功能实现状态总览

本文件对照产品需求列出当前仓库的实现进度。状态分为：`✅ 已实现`、`🚧 规划中`、`❌ 未实现`。

## 1. 主题与商品管理

| 功能 | 状态 | 说明 |
| --- | --- | --- |
| 主题列表分页、按更新时间排序、创建/编辑/删除 | ✅ | `GET/POST/PATCH/DELETE /themes` 已实现，支持分页与更新时间过滤。 |
| 主题偏好设置（预设标签 + 自由文本） | ✅ | `ThemePreference` 字段完整保留并在接口中读写。 |
| 创建主题时添加商品 | ✅ | `ThemeCreate.products` 支持初始化商品集合并自动入库。 |
| 主题商品列表、左滑删除、加号添加 | ✅ | `GET /themes/{id}/products`、`POST /themes/{id}/products`、`DELETE /themes/{id}/products/{pid}` 提供所需操作。 |
| 商品模型字段 | ✅ | `ProductResponse` 覆盖头图、价格、参数、物流、榜单、售后、评价、问大家、店铺、详细介绍等字段。 |
| 商品列表 Tab | ✅ | `GET /products` 返回所有商品，`POST /products` 支持上行更新。 |
| 商品导入（链接/截图占位） | ✅ | `POST /products/import` 根据链接生成占位商品，支持后续补充信息。 |
| 单商品详情页 API | ✅ | `GET /products/{id}` 返回完整商品数据。 |

## 2. 询问与主题总结

| 功能 | 状态 | 说明 |
| --- | --- | --- |
| 主题切换到询问 Tab 时展示历史 | ✅ | `GET /themes/{id}/inquiries` 返回历史会话列表。 |
| 无历史时生成分类总结 | ✅ | 同端点会在无历史时调用摘要生成逻辑。 |
| 文本/语音（文本）询问并触发大模型回复 | ✅ | `POST /inquiries/{session}/messages` 处理用户消息并生成 AI 建议（当前为规则生成）。 |
| 单商品询问 | ✅ | 会话模型支持 `channel=single_product` 并参考商品上下文。 |
| 询问记录持久化与多端同步 | ✅ | 所有消息写入 JSON 存储，同时记录版本号，`GET /sync/changes` 可增量获取。 |

## 3. 工具面板

| 功能 | 状态 | 说明 |
| --- | --- | --- |
| 工具列表 | ✅ | `GET /tools` 返回参数对比、预算搭配、环保优选等预设工具。 |
| 工具调用与记录 | ✅ | `POST /tools/{id}/invoke` 结合主题/商品上下文生成建议并写入调用日志。 |

## 4. 同步与持久化

| 功能 | 状态 | 说明 |
| --- | --- | --- |
| 持久化 | ✅ | 现阶段使用 `data/storage.json` 落地数据，后续可替换为 PostgreSQL。 |
| 多端同步 | ✅ | 所有实体操作写入变更日志，通过 `GET /sync/changes` 增量同步。 |
| LLM 调用能力 | 🚧 | 当前提供规则化回复，待接入 ChatGPT/Gemini/Qwen。 |

## 5. 客户端（KMP + Compose）

| 功能 | 状态 | 说明 |
| --- | --- | --- |
| 业务容器、生命周期钩子、API 网关 | ❌ | 尚未开始实现。 |
| 状态管理、事件系统 | ❌ | 尚未开始实现。 |
| KMP UI（主题/商品/询问/工具 Tab、单商品模式、PDP） | ❌ | 尚未开始实现。 |
| 语音输入 | ❌ | 尚未实现，仅保留接口需求。 |

## 6. 后续计划

1. 将临时 JSON 存储替换为 PostgreSQL + SQLAlchemy/Alembic，实现事务与并发控制。
2. 接入真实大模型网关，使用流式回调返回 AI 响应，并支持工具调用。
3. 实现 KMP 客户端业务容器、Compose UI 及语音能力，与服务端 API 打通。
4. 为核心服务补充单元测试与 CI/CD 流水线，增强质量保障。
